# üê≥ DTEK Monitor - Docker Setup

–ó–∞–ø—É—Å–∫ DTEK Monitor —É Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –∑–∞–º—ñ—Å—Ç—å GitHub Actions.

## üìã –ü–µ—Ä–µ–≤–∞–≥–∏ Docker

- ‚úÖ –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø—É—Å–∫—É –Ω–∞ –≤–ª–∞—Å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ/–∫–æ–º–ø'—é—Ç–µ—Ä—ñ
- ‚úÖ –ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –æ–±–º–µ–∂–µ–Ω—å GitHub Actions
- ‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –≤ –ª–æ–∫–∞–ª—å–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –õ–µ–≥–∫–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑–∫–ª–∞–¥—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í–∏–º–æ–≥–∏

- Docker
- Docker Compose
- –§–∞–π–ª `.env` –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è `.env` —Ñ–∞–π–ª—É

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ—î–∫—Ç—É:

```env
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=-12346789
CITY=–í–∞—Å—é–∫—ñ–≤–∫–∞
STREET=–ü–µ—Ä–µ–º–æ–≥–∏
HOUSE=1
```

### 2. –ó–∞–ø—É—Å–∫

```bash
# –ó–±—É–¥—É–≤–∞—Ç–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker-compose up -d

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
docker-compose logs -f

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∞
docker-compose logs -f monitor

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
docker-compose logs -f scheduler
```

### 3. –ó—É–ø–∏–Ω–∫–∞

```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker-compose down

# –ó—É–ø–∏–Ω–∏—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ
docker-compose down -v
```

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ Docker Setup

### –°–µ—Ä–≤—ñ—Å–∏

1. **monitor** - –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ Node.js —Ç–∞ Playwright
   - –ú—ñ—Å—Ç–∏—Ç—å –∫–æ–¥ –¥–æ–¥–∞—Ç–∫—É
   - –ó–±–µ—Ä—ñ–≥–∞—î –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ –≤ `./artifacts`
   - –í–∏–∫–æ–Ω—É—î –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é –≤—ñ–¥ scheduler

2. **scheduler** - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ cron –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–æ–º
   - –ó–∞–ø—É—Å–∫–∞—î `monitor` –∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Docker socket –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥

### –§–∞–π–ª–∏

- **Dockerfile** - –û–±—Ä–∞–∑ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∞ –∑ Playwright
- **docker-compose.yml** - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
- **.dockerignore** - –í–∏–∫–ª—é—á–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑ –æ–±—Ä–∞–∑—É
- **.env** - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (–Ω–µ –∫–æ–º—ñ—Ç–∏—Ç—å—Å—è)

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ó–º—ñ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ `docker-compose.yml`, —Å–µ–∫—Ü—ñ—é `scheduler`:

```yaml
environment:
  # –ö–æ–∂–Ω—ñ 30 —Ö–≤–∏–ª–∏–Ω
  - CRON_SCHEDULE=*/30 * * * * docker exec dtek-monitor node monitor.js

  # –ö–æ–∂–Ω—É –≥–æ–¥–∏–Ω—É
  - CRON_SCHEDULE=0 * * * * docker exec dtek-monitor node monitor.js

  # –ö–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
  - CRON_SCHEDULE=*/5 * * * * docker exec dtek-monitor node monitor.js
```

–ü—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å:

```bash
docker-compose down
docker-compose up -d
```

### –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

```bash
# –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –≤—Ä—É—á–Ω—É
docker exec dtek-monitor node monitor.js
```

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –ª–æ–≥–∏

### –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤

```bash
docker-compose ps
```

### –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

```bash
# –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏
docker-compose logs -f

# –¢—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 50 —Ä—è–¥–∫—ñ–≤
docker-compose logs --tail=50 -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Å–µ—Ä–≤—ñ—Å
docker-compose logs -f monitor
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏

```bash
# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –∑–±–µ—Ä–µ–∂–µ–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
cat artifacts/last-message.json
```

## üîß –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –ü–µ—Ä–µ–±—É–¥—É–≤–∞—Ç–∏ –æ–±—Ä–∞–∑ –ø—ñ—Å–ª—è –∑–º—ñ–Ω –∫–æ–¥—É
docker-compose up -d --build

# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it dtek-monitor /bin/bash

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏
docker-compose restart

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
docker stats dtek-monitor dtek-scheduler

# –û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ –æ–±—Ä–∞–∑–∏
docker image prune -a
```

## üêõ –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –∑–±—ñ—Ä–∫–∏
docker-compose build --no-cache

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏
docker-compose logs --tail=100
```

### Playwright –ø–æ–º–∏–ª–∫–∏

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤
docker exec dtek-monitor npx playwright --version
```

### –ü—Ä–æ–±–ª–µ–º–∏ –∑ cron

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
docker-compose logs scheduler

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –ø—Ä–∞—Ü—é—î cron
docker exec dtek-scheduler ps aux | grep cron
```

## üì¶ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ (last-message.json) –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `./artifacts` —á–µ—Ä–µ–∑ bind mount. –¶–µ –æ–∑–Ω–∞—á–∞—î:

- ‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –º—ñ–∂ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –ú–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏/–ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ —Ö–æ—Å—Ç–∞
- ‚úÖ –ù–µ –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è –ø—Ä–∏ `docker-compose down`

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ:

```bash
rm -rf artifacts/
```

## üîÑ –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ GitHub Actions

–Ø–∫—â–æ —Ä–∞–Ω—ñ—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ GitHub Actions:

1. –°–∫–æ–ø—ñ—é–π—Ç–µ `artifacts/last-message.json` –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é —É –ª–æ–∫–∞–ª—å–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
2. –í–∏–º–∫–Ω—ñ—Ç—å GitHub Actions workflow (–∞–±–æ –≤–∏–¥–∞–ª—ñ—Ç—å `.github/workflows/monitor.yml`)
3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å Docker setup

## üÜö –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ GitHub Actions

| –ê—Å–ø–µ–∫—Ç | GitHub Actions | Docker |
|--------|---------------|--------|
| –•–æ—Å—Ç–∏–Ω–≥ | GitHub —Å–µ—Ä–≤–µ—Ä–∞—Ö | –í–∞—à —Å–µ—Ä–≤–µ—Ä |
| –í–∞—Ä—Ç—ñ—Å—Ç—å | –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | –†–µ—Å—É—Ä—Å–∏ –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ |
| –ö–æ–Ω—Ç—Ä–æ–ª—å | –û–±–º–µ–∂–µ–Ω–∏–π | –ü–æ–≤–Ω–∏–π |
| –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è | –ß–µ—Ä–µ–∑ secrets | –ß–µ—Ä–µ–∑ .env |
| –õ–æ–≥–∏ | –£ GitHub | –õ–æ–∫–∞–ª—å–Ω–æ |
| –°—Ç–∞–Ω | Git commits | –õ–æ–∫–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏ |

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- Docker –æ–±—Ä–∞–∑ –º—ñ—Å—Ç–∏—Ç—å Chromium (~400MB), —Ç–æ–º—É –ø–µ—Ä—à–∞ –∑–±—ñ—Ä–∫–∞ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ —á–∞—Å
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –ø–æ—Ä—Ç Docker socket –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–∞
- `.env` —Ñ–∞–π–ª –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –∫–æ–º—ñ—Ç–∏—Ç–∏—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π (–≤–∂–µ –≤ .gitignore)
